---
title: ECMAScript 2016, 2017, å’Œ2018ä¸­æ–°å¢åŠŸèƒ½çš„ç¤ºä¾‹
date: 2018-04-11
copyright: true
authors:
  - name: sachieyuan
    link: https://github.com/sachieyuan
  - name: SevenOutman
    link: https://github.com/SevenOutman
tag:
- ECMAScript 2016
- ECMAScript 2017
- ECMAScript 2018
---


# ä»¥ä¸‹æ˜¯ ECMAScript 2016, 2017, å’Œ 2018 ä¸­æ–°å¢åŠŸèƒ½çš„ç¤ºä¾‹


[åŸæ–‡é“¾æ¥](https://medium.freecodecamp.org/here-are-examples-of-everything-new-in-ecmascript-2016-2017-and-2018-d52fa3b5a70e)

è¦è·Ÿä¸Š JavaScript(ECMAScript) æ›´æ–°çš„è„šæ­¥å¾ˆéš¾ï¼Œæ›´éš¾çš„æ˜¯æ‰¾åˆ°æœ‰ç”¨çš„ä»£ç ç¤ºä¾‹ã€‚

å› æ­¤ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä»‹ç»åœ¨ ES2016ï¼ŒES2017 å’Œ ES2018ï¼ˆæœ€ç»ˆè‰æ¡ˆï¼‰ä¸­æ·»åŠ çš„TC39å·²å®Œæˆææ¡ˆä¸­åˆ—å‡ºçš„æ‰€æœ‰ 18 ä¸ªæ–°ç‰¹æ€§ï¼Œå¹¶ä¸€ä¸€å±•ç¤ºæœ‰ç”¨çš„ç¤ºä¾‹ã€‚

> è¿™ç¯‡æ–‡ç« å¾ˆé•¿ï¼Œä¸è¿‡åº”è¯¥å¾ˆå®¹æ˜“è¯»ï¼Œå¯ä»¥å½“æˆä¸€ç¯‡â€œNetflix binge readingâ€ã€‚æˆ‘ä¿è¯ä½ è¯»å®Œåå°†å¯¹è¿™äº›æ–°ç‰¹æ€§æœ‰å¾ˆå¤šçš„äº†è§£ã€‚

**å¥½ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥çœ‹çœ‹ã€‚**

<!-- more -->

## ECMAScript 2016

- ### 1. Array.prototype.includes

`includes` æ˜¯ Array çš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œç”¨æ¥è½»æ¾æŸ¥æ‰¾æŸä¸ªé¡¹æ˜¯å¦åœ¨ Array ä¸­ï¼ˆåŒ…æ‹¬ `NaN`ï¼Œè¿™ç‚¹ `indexOf` åšä¸åˆ°ï¼‰

```js
const arr = [ 1, 2, 3, 4, NaN];

// es2016ä¸ä½¿ç”¨
if(arr.indexOf(3) >= 0){
  console.log(true);
}

// ä½¿ç”¨
if(arr.includes(3)){
  console.log(true);
}

//ps: æ³¨æ„ indexOf æ˜¯ä¸æ”¯æŒæŸ¥æ‰¾NaNçš„
arr.includes(NaN) // true
arr.indexOf(NaN) // -1 (indexOf ä¸æ”¯æŒ NaN)
```

> å†·çŸ¥è¯†ï¼šJavaScript è§„èŒƒåˆ¶å®šè€…æœ¬æƒ³ç»™å®ƒå–åå« `contains`ï¼Œä½†è¿™æ˜¾ç„¶å·²è¢« Mootools ä½¿ç”¨ï¼Œå› æ­¤ä»–ä»¬ä½¿ç”¨äº† `includes`ã€‚

- ### 2. å¹‚è¿ç®—ç¬¦

æ•°å­¦è¿ç®—å¦‚åŠ æ³•å’Œå‡æ³•åˆ†åˆ«æœ‰ `+` å’Œ `-` ç­‰è¿ç®—ç¬¦ã€‚ä¸ä»–ä»¬ç±»ä¼¼ï¼Œ`**` è¿ç®—ç¬¦é€šå¸¸ç”¨äºå¹‚è¿ç®—ã€‚åœ¨ ECMAScript 2016 ä¸­å¼•å…¥äº† `**`ï¼Œå–ä»£ `Math.pow`ã€‚

```js
// ä¸ä½¿ç”¨
Math.pow(7,2) //49

// ä½¿ç”¨
7**2 //49

```

## ECMAScript 2017

- ### 1. Object.values()

`Object.value()` æ˜¯ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå®ƒä¸ `Object.keys()` ç±»ä¼¼ï¼Œä½†è¿”å›çš„äº‹ Object æ‰€æœ‰å±æ€§çš„å€¼ï¼ˆä¸åŒ…æ‹¬æ¥è‡ªåŸå‹é“¾çš„å±æ€§ï¼‰ã€‚

```js
const cars = { 'BMW': 3, 'Tesla': 2, 'Toyota': 1 };

// ES2015
// ES2017 ä¸ä½¿ç”¨
const vals = Object.keys(cars).map(key => cars[key]);
console.log(vals); //[3, 2, 1]


// ES2017 and æœªæ¥
// ä½¿ç”¨
const values = Object.values(cars);
console.log(values); // [3, 2, 1]

```

- ### 2. Object.entries()

`Object.entries()` ä¸ `Object.keys` ç›¸å…³ï¼Œä½†ä¸æ˜¯ä»…è¿”å› keysï¼Œè€Œæ˜¯ä»¥æ•°ç»„æ–¹å¼è¿”å› keys å’Œ valuesã€‚è¿™è®©ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°éå†å¯¹è±¡ï¼Œæˆ–è€…æŠŠå¯¹è±¡è½¬æ¢ä¸º Mapsã€‚

ä¾‹ 1:

```js
const cars = { 'BMW': 3, 'Tesla': 2, 'Toyota': 1 };
// ES5.1
// è€Œä¸æ˜¯æå–é”®ç„¶åå†å¾ªç¯
Object.keys(cars).forEarch(function(key) {
	console.log('key: ' + key + 'value: ' + cars[key]);
})

// ES2017 (ES8)
// ä½¿ç”¨ Object.entries
for(let [key value] of Object.entries(cars)) {
	console.log(`key: ${key} value: ${value}`);
}

```

ä¾‹ 2:

```js
const cars = { 'BMW': 3, 'Tesla': 2, 'Toyota': 1 };

// ES2015
// ä¸ä½¿ç”¨
// è·å–å¯¹è±¡é”®ï¼Œç„¶åæ·»åŠ æ¯ä¸ªé¡¹ç›®ä»¥åœ¨å¾ªç¯ä¸­æ˜ å°„

const maps = new Map();
Object.keys(cars).forEarch(key => {
	map1.set(key, cars[key]);
})

console.log(map1) // Map { 'BMW' => 3, 'Tesla' => 2, 'Toyota' => 1}

// ES2017 and ä»¥å
// ä½¿ç”¨
const map = new Map(Object.entries(cars));

console.log(map) //Map { 'BMW' => 3, 'Tesla' => 2, 'Toyota' => 1}


```

- ### 3. å­—ç¬¦ä¸²å¡«å……

String å¢åŠ äº†ä¸¤ä¸ªå®ä¾‹æ–¹æ³• -- `String.prototype.padStart` å’Œ `String.prototype.padEnd`ï¼Œç”¨äºåœ¨åŸå­—ç¬¦ä¸²çš„å¼€å¤´æˆ–ç»“å°¾æ·»åŠ ä¸€æ®µå­—ç¬¦ä¸²æˆ–ç©ºå­—ç¬¦ä¸²ã€‚

```ECMAScript
'someString'.padStart(numberOfCharcters [,stringForPadding]);
'5'.padStart(10) // '          5'
'5'.padStart(10, '=*') //'=*=*=*=*=5'
'5'.padEnd(10) // '5         '
'5'.padEnd(10, '=*') //'5=*=*=*=*='

```

> è¿™åœ¨éœ€è¦å¯¹é½äº‹ç‰©çš„åœºæ™¯ä¸‹å¾ˆæ–¹ä¾¿ï¼Œè¯¸å¦‚æ¼‚äº®çš„æ‰“å°æ˜¾ç¤ºæˆ–ç»ˆç«¯æ‰“å°ã€‚

- #### 3.1 padStart ä¾‹å­

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ç»„é•¿åº¦ä¸åŒçš„æ•°å­—ã€‚ä¸ºäº†æ˜¾ç¤ºå¥½çœ‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å®ƒä»¬å‰é¢è¡¥â€œ0â€ï¼Œè®©å®ƒä»¬é•¿åº¦éƒ½è¾¾åˆ° 10ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `padStart(10, '0')` è½»æ¾å®ç°è¿™ä¸€ç‚¹ã€‚

```js
// ES2017
// å¦‚æœä½ æœ‰ä¸€ä¸ªä¸åŒé•¿åº¦çš„é¡¹ç›®åˆ—è¡¨ï¼Œå¹¶å¸Œæœ›æ ¼å¼åŒ–å®ƒä»¬çš„æ˜¾ç¤ºç›®çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨padStart

const formatted = [0, 1, 12, 123, 1234, 12345].map(num =>
	num.toString().padStart(10, '0') // æ·»åŠ  0 ç›´åˆ°é•¿åº¦ä¸º 10
);

console.log(formatted);

// æ‰“å°
// [
// 	'0000000000',
// 	'0000000001',
// 	'0000000012',
// 	'0000000123',
// 	'0000001234',
// 	'0000012345',
// ]

```

- #### 3.2 padEnd ä¾‹å­:

æˆ‘ä»¬æ‰“å°å¤šä¸ªä¸åŒé•¿åº¦çš„é¡¹ç›®å¹¶æƒ³è¦å³å¯¹é½å®ƒä»¬æ—¶ï¼Œ`padEnd` çœŸçš„å¾ˆæ–¹ä¾¿ã€‚

ä¸‹é¢çš„ä¾‹å­å¾ˆå¥½åœ°å±•ç¤ºäº†å¦‚ä½•è¿ç”¨ `padEnd`ï¼Œ`padStart` å’Œ `Object.entries` äº§ç”Ÿæ¼‚äº®çš„è¾“å‡ºã€‚

```js
const cars = {
  'ğŸš™BMW': '10',
  'ğŸš˜Tesla': '5',
  'ğŸš–Lamborghini': '0'
}
Object.entries(cars).map(([name, count]) => {
  //padEnd appends ' -' until the name becomes 20 characters
  //padStart prepends '0' until the count becomes 3 characters.
  console.log(`${name.padEnd(20, ' -')} Count: ${count.padStart(3, '0')}`)
});
// æ‰“å°ç»“æœ..
// ğŸš™BMW - - - - - - -  Count: 010
// ğŸš˜Tesla - - - - - -  Count: 005
// ğŸš–Lamborghini - - -  Count: 000

```

 - #### 3.3 âš ï¸ Emoji å’Œå…¶ä»–åŒå­—èŠ‚å­—ç¬¦ä¸Šçš„ padStart å’Œ padEnd

Emoji å’Œå…¶ä»–åŒå­—èŠ‚å­—ç¬¦ä½¿ç”¨å¤šä¸ª unicode å­—èŠ‚è¡¨ç¤ºã€‚æ‰€ä»¥ `padStart` å’Œ `padEnd` å¯èƒ½æ— æ³•æŒ‰é¢„æœŸå·¥ä½œï¼âš ï¸

ä¾‹å¦‚ï¼šå‡è®¾æˆ‘ä»¬æ­£åœ¨å°è¯•ç”¨ â¤ ï¸è¡¨æƒ…ç¬¦å·å¡«å……å­—ç¬¦ä¸² `heart` ä»¥è¾¾åˆ°10ä¸ªå­—ç¬¦ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```js
// æ³¨æ„ï¼Œä¸æ˜¯5é¢—å¿ƒï¼Œåªæœ‰2é¢—å¿ƒå’Œ1é¢—çœ‹èµ·æ¥å¾ˆå¥‡æ€ªçš„å¿ƒï¼

'heart'.padStart(10, "â¤ï¸"); // prints.. 'â¤ï¸â¤ï¸â¤heart'
```

è¿™æ˜¯å› ä¸º â¤ ï¸é•¿ 2 ä¸ªå­—ç¬¦(`'\u2764\uFE0F'`)ï¼å•è¯ heart æœ¬èº«æ˜¯ 5 ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬è¦å¡«å……å‰©ä¸‹çš„ 5 ä¸ªå­—ç¬¦ã€‚æ‰€ä»¥ JS å…ˆå¡«å……äº†ä¸¤ä¸ª `'\u2764\uFE0F'` ï¼ˆä¹Ÿå°±æ˜¯ â¤ï¸â¤ï¸ï¸ï¼‰ ï¸ï¼Œæœ€åå‰©ä¸‹ä¸€ä¸ªå­—èŠ‚å¡«å……äº† `\ u2764`ï¼Œè€Œå®ƒå¯¹åº”çš„æ˜¯å°å¿ƒå½¢ â¤ã€‚

æ‰€ä»¥ç»“æœæ˜¯: `â¤ï¸â¤ï¸â¤heart`

> PSï¼šæ‚¨å¯ä»¥ä½¿ç”¨[æ­¤é“¾æ¥](https://encoder.internetwache.org/#tab_uni) æŸ¥çœ‹ unicode å­—ç¬¦è½¬æ¢

- ### 4. Object.getOwnPropertyDescriptors

æ­¤æ–¹æ³•è¿”å›ç»™å®šå¯¹è±¡çš„æ‰€æœ‰å±æ€§çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯(åŒ…æ‹¬ `get` `set` æ–¹æ³•)ã€‚ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†åœ¨æµ…æ‹·è´/å…‹éš†ä¸€ä¸ªå¯¹è±¡åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸­æ—¶ï¼Œèƒ½æŠŠ getter å’Œ setter ä¹Ÿå¤åˆ¶è¿‡å»ï¼Œå› ä¸º `Object.assign` æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚

**Object.assign æµ…å…‹éš†é™¤åŸå§‹æºå¯¹è±¡çš„ getter å’Œ setter å‡½æ•°ä»¥å¤–çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ã€‚**


ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†åˆ†åˆ«ä½¿ç”¨ `Object.assign` å’Œ `Object.getOwnPropertyDescriptors`ï¼ˆé…åˆ `Object.defineProperties`ï¼‰ ä»¥å°†åŸå§‹å¯¹è±¡ `Car` å¤åˆ¶åˆ°æ–°å¯¹è±¡ `ElectricCar` æ—¶çš„åŒºåˆ«ã€‚ä½ ä¼šå‘ç°ä½¿ç”¨ `Object.getOwnPropertyDescriptors` ä¼šå°† `discount` çš„ getter å’Œ setter ä¹Ÿè¢«å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ä¸­ã€‚

###### ä¹‹å‰...

```js
// ä¹‹å‰...
var Car = {
	name: 'BMW',
	price: 1000000,
	set discount(x) {
		this.d = x;
	},
	get discount() {
		return this.d;
	},
};

// æ‰“å°Carå¯¹è±¡çš„â€œdiscountâ€å±æ€§çš„è¯¦ç»†ä¿¡æ¯
console.log(Object.getOwnPropertyDescriptor(Car, 'discount'));
// æ‰“å°ç»“æœ..
// {
// 	get: [Function: get],
// 	set: [Function: set],
// 	enumerable: true,
// 	configurable: true
// }

// ä½¿ç”¨Object.assignå°†Carçš„å±æ€§å¤åˆ¶åˆ°ElectricCar
const ElectricCar = Object.assign({}, Car)ï¼›

//æ‰“å°ElectricCarå¯¹è±¡çš„â€œdiscountâ€å±æ€§çš„è¯¦ç»†ä¿¡æ¯
console.log(Object.getOwnPropertyDescriptor(ElectricCar, 'discount'));

// æ‰“å°
// {
// 	value: undefined,
// 	writable: true,
// 	enumerable: true,
// 	configurable: true
// }

// âš ï¸ è¯·æ³¨æ„ElectricCarå¯¹è±¡ä¸­çš„â€œdiscountâ€å±æ€§ä¸­ç¼ºå°‘getterå’Œsetterï¼ğŸ‘ğŸ‘
```
###### ä»¥å...

```js
// ä»¥å...
var Car = {
	name: 'BMW',
	price: 1000000,
	set discount(x) {
		this.d = x;
	},
	get discount() {
		return this.d;
	},
};
// ä½¿ç”¨Object.definePropertieså°†Carçš„å±æ€§å¤åˆ¶åˆ°ElectricCar2
// å¹¶ä½¿ç”¨Object.getOwnPropertyDescriptorsæå–Carçš„å±æ€§

const ElectricCar2 = Object.defineProperties({}, Object.getOwnPropertyDescriptors(Car));
// æ‰“å°ElectricCar2å¯¹è±¡â€œdiscountâ€å±æ€§çš„è¯¦ç»†ä¿¡æ¯
console.log(Object.getOwnPropertyDescriptor(ElectricCar2, 'discount'));
// prints..
// { get: [Function: get],  ğŸ‘ˆğŸ¼ğŸ‘ˆğŸ¼ğŸ‘ˆğŸ¼
//   set: [Function: set],  ğŸ‘ˆğŸ¼ğŸ‘ˆğŸ¼ğŸ‘ˆğŸ¼
//   enumerable: true,
//   configurable: true
// }
// è¯·æ³¨æ„ï¼Œgetterå’Œsetterå­˜åœ¨äºElectricCar2å¯¹è±¡ä¸­ï¼Œç”¨äº'discount'å±æ€§ï¼

```

- ### 5. åœ¨å‡½æ•°å‚æ•°ä¸­æ·»åŠ å°¾åé€—å·(trailing commas)

è¿™æ˜¯ä¸€ä¸ªå°çš„æ›´æ–°ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨æœ€åä¸€ä¸ªå‡½æ•°å‚æ•°åé¢åŠ ä¸Šå°¾éšé€—å·ã€‚æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ å½“ä½ ä½¿ç”¨ git blame æ—¶ï¼Œè¿™èƒ½ç¡®ä¿åªæœ‰æ–°å¢çš„å‚æ•°è¢«æ˜¾ç¤ºå‡ºæ¥ã€‚

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ:

```js
// é—®é¢˜

//	#1 å¼€å‘è€…åˆ›å»º
function Person(
	name,
	age
	) {
		this.name = name;
		this.age = age;
}

// #2 å¼€å‘è€…æ·»åŠ address
function Person(
	name,
	age, // æ·»åŠ å°¾éšé€—å· 	<--------å› ä¸ºé€—å·ï¼Œå¼€å‘äººå‘˜ä¼šè¢«gitç­‰å·¥å…·æ‰€è­¦å‘Š
	address //æ·»åŠ æ–°çš„å‚æ•°
  ) {
		this.name = name;
		this.age = age;
		this.address = address; //æ·»åŠ çš„è¿™è¡Œ
}

// ES2017 è§£å†³
// å…è®¸#1å¼€å‘è€…æ·»åŠ å°¾éšé€—å·
// #1 åˆ›å»ºå¦‚ä¸‹
function Person(
	name,
	ange,  //<------- ç”±äºå°¾éšé€—å·ï¼Œ#2å¼€å‘è€…ä¸éœ€è¦æ”¹å˜è¿™è¡Œ
	) {
		this.name = name;
		this.age = age;
}
```

> æ³¨æ„ï¼šæ‚¨ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°æ—¶ä½¿ç”¨å°¾åé€—å·ï¼


- ### 6. Async/Await

è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨æˆ‘çœ‹æ¥æ˜¯è¿„ä»Šä¸ºæ­¢æœ€é‡è¦ä¹Ÿæ˜¯æœ€æœ‰ç”¨çš„ç‰¹æ€§ã€‚å¼‚æ­¥å‡½æ•°æŠŠæˆ‘ä»¬ä»å›è°ƒåœ°ç‹±ä¸­è§£æ”¾å‡ºæ¥ï¼Œå¹¶ä½¿æ•´ä¸ªä»£ç çœ‹èµ·æ¥å¾ˆç®€æ´ã€‚


`async` å…³é”®å­—å‘Šè¯‰ JavaScript ç¼–è¯‘å™¨ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†å‡½æ•°ï¼Œç¼–è¯‘å™¨åœ¨è¯¥å‡½æ•°å†…åˆ°è¾¾ `await` å…³é”®å­—æ—¶æš‚åœã€‚å®ƒå‡è®¾ `await` ä¹‹åçš„è¡¨è¾¾å¼è¿”å›ä¸€ä¸ª Promiseï¼Œå¹¶ç­‰åˆ° Promise è¢« resolve æˆ– reject åæ‰ç»§ç»­å‰è¿›ã€‚

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ`getAmount` å‡½æ•°è°ƒç”¨ä¸¤ä¸ªå¼‚æ­¥å‡½æ•° `getUser` å’Œ `getBankBalance`ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ Promise åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†ä½¿ç”¨ `async await` æ›´ä¼˜é›…å’Œç®€æ´ã€‚

```js
// ä¸ä½¿ç”¨
// ES2015 Promise

function getAmount(userId) {
	getUser(userId)
		.then(getBankBalance)
		.then(amount => {
			console.log(amount);
		});
}

// ä½¿ç”¨...
// ES2017

async function getAmount2(userId) {
	var user = await getUser(userId);
	var amount = await getBankBalance(user);
	console.log(amount);
}

getAmount('1'); //$1,000

getAmount2('1'); //$1,000

function getUser(userId) {
	return new Promise(resolve => {
		setTimeout(() => {
			resolve('john')
		}, 1000)
	});
}

function getBankBalance(user) {
	return new Promise((resolve, reject) => {
		setTimeout(() => {
			if(user == 'john') {
				resolve('$1,000');
			} else {
				reject(unknown user);
			}
		}, 1000)
	});
}
```

- #### 6.1 å¼‚æ­¥å‡½æ•°æœ¬èº«è¿”å›ä¸€ä¸ª Promise

å¦‚æœæ‚¨è¦ç­‰å¾…å¼‚æ­¥å‡½æ•°çš„ç»“æœï¼Œåˆ™éœ€è¦ä½¿ç”¨ Promise çš„ `then` è¯­æ³•æ¥æ•è·å®ƒã€‚

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æƒ³ä½¿ç”¨ `console.log` åœ¨ doubleAndAdd çš„å¤–éƒ¨æ‰“å°å‡ºå®ƒçš„ç»“æœã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ `then` æ¥ç­‰å¾…å¹¶è·å–å®ƒçš„ç»“æœä¼ é€’ç»™ `console.log`ã€‚

```js

// å¼‚æ­¥å‡½æ•°æœ¬èº«è¿”å›ä¸€ä¸ªPromise
async function doubleAndAdd(a, b) {
	a = await doubleAfterlSec(a);
	b = await doubleAfterlSec(b);
	return a + b;
}

// ç”¨æ³•
doubleAndAdd(1, 2).then(console.log);

function doubleAfterlSec(param) {
	return new Promise (resolve => {
		setTimeout(resolve(param * 2), 1000);
	});
}

```

- #### 6.2 å¹¶è¡Œè°ƒç”¨ async/await

åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†ä¸¤æ¬¡ awaitï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šç­‰å¾…ä¸€ç§’ï¼ˆæ€»å…±ä¸¤ç§’ï¼‰ã€‚ä¸è¿‡æ—¢ç„¶ `a` å’Œ `b` æ²¡æœ‰ç›¸äº’ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Promise.all` æ¥å¹¶è¡Œè°ƒç”¨å®ƒä»¬ã€‚

```js
// å¼‚æ­¥å‡½æ•°æœ¬èº«è¿”å›ä¸€ä¸ªPromise
async function doubleAndAdd(a, b) {
	//æ³¨æ„ï¼šè¿™è¾¹ä½¿ç”¨ Promise.all
	//æ³¨æ„åˆ°ä½¿ç”¨æ•°ç»„è§£æ„,æ•è·ç»“æœ
	[a, b] = await Promise.all([doubleAfterlSec(a), doubleAfterlSec(b)]);
	return a + b;
}

// ç”¨æ³•
doubleAndAdd(1, 2).then(console.log);

function doubleAfterlSec(param) {
	return new Promise (resolve => {
		setTimeout(resolve(param * 2), 1000);
	});
}
```
- #### 6.3 async/await å‡½æ•°æ—¶çš„é”™è¯¯å¤„ç†

ä½¿ç”¨ async await æ—¶æœ‰å¥½å‡ ç§å¤„ç†é”™è¯¯çš„æ–¹å¼ã€‚

> Option 1 - åœ¨å‡½æ•°ä¸­ä½¿ç”¨ try catch

```js
// 1. ä½¿ç”¨ try catch

async function doubleAndAdd(a, b) {
	try {
		a = await doubleAfterlSec(a);
		b = await doubleAfterlSec(b);
	} catch (e) {
		return NaN; // return something
	}
	return a + b;
}

// ç”¨æ³•
doubleAndAdd('one', 2).then(console.log) //NaN
doubleAndAdd(1, 2).then(console.log) // 6

function doubleAfterlSec(param) {
	return new Promise((resolve, reject) => {
		setTimeout(function() {
			let val = param * 2;
			isNaN(val) > reject(NaN) : resolve(val);
		}, 1000);
	});
}
```

> Option 2 â€” catch æ¯ä¸€ä¸ª await

ç”±äºæ¯ä¸ª `await` è¡¨è¾¾å¼éƒ½ä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨æ¯è¡Œä¸Šæ•è·é”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```js
// Option 2 - *Catch* æ¯ä¸ªç­‰å¾…çº¿ä¸Šçš„é”™è¯¯
// å› ä¸ºæ¯ä¸ªç­‰å¾…è¡¨è¾¾æœ¬èº«å°±æ˜¯ä¸€ä¸ªPromise
async function doubleAndAdd(a, b) {
	a = await doubleAfter1Sec(a).catch(e => console.log('"a" is NaN')); // ğŸ‘ˆ
  b = await doubleAfter1Sec(b).catch(e => console.log('"b" is NaN')); // ğŸ‘ˆ
  if (!a || !b) {
  	return NaN;
  }
	return a + b;
}
// ç”¨æ³•:
doubleAndAdd('one', 2).then(console.log); // NaN  and logs:  "a" is NaN
doubleAndAdd(1, 2).then(console.log); // 6
function doubleAfter1Sec(param) {
	return new Promise((resolve, reject) => {
		setTimeout(function() {
			let val = param * 2;
			isNaN(val) ? reject(NaN) : resolve(val);
		}, 1000);
	});
}


```

> Option 3â€Šâ€”â€Šcatch æ•´ä¸ª async-await å‡½æ•°

```js
// Option 3 - ä¸è¦åšä»»ä½•äº‹æƒ…ï¼Œåœ¨functionå¤–æ•è·
// å› ä¸ºå¼‚æ­¥/ç­‰å¾…è¿”å›ä¸€ä¸ªPromiseï¼Œæˆ‘ä»¬å¯ä»¥æ•æ‰æ•´ä¸ªå‡½æ•°çš„é”™è¯¯
async function doubleAndAdd(a, b) {
 a = await doubleAfter1Sec(a);
 b = await doubleAfter1Sec(b);
 return a + b;
}
// ç”¨æ³•
doubleAndAdd('one', 2)
.then(console.log)
.catch(console.log); // ğŸ‘ˆğŸ‘ˆğŸ¼<------- use "catch"
function doubleAfter1Sec(param) {
 return new Promise((resolve, reject) => {
  setTimeout(function() {
   let val = param * 2;
   isNaN(val) ? reject(NaN) : resolve(val);
  }, 1000);
 });
}
```

## ECMAScript 2018

> ECMAScript ç›®å‰å¤„äºæœ€ç»ˆè‰æ¡ˆä¸­ï¼Œå°†äº 2018 å¹´ 6 æœˆæˆ– 7 æœˆå‘å¸ƒã€‚ä»¥ä¸‹æ‰€æœ‰ç‰¹æ€§å‡åœ¨ Stage-4 ä¸­ï¼Œå¹¶å°†æˆä¸º ECMAScript 2018 çš„ä¸€éƒ¨åˆ†ã€‚

- ###  1. å…±äº«å†…å­˜å’ŒåŸå­æ“ä½œ ([Shared memory and atomics](https://github.com/tc39/ecmascript_sharedme))

è¿™æ˜¯ä¸€ä¸ªéå¸¸å…ˆè¿›é‡å¤§ç‰¹æ€§ï¼Œæ˜¯å¯¹ JS å¼•æ“çš„æ ¸å¿ƒå¢å¼ºã€‚

**ä¸»è¦çš„æƒ³æ³•æ˜¯ä¸ºäº†ç»™ JavaScript å¸¦æ¥ä¸€äº›å¤šçº¿ç¨‹çš„ç‰¹æ€§ï¼Œå…è®¸å†…å­˜ä¸ä»…ä»…ç”± JS å¼•æ“æ¥ç®¡ç†ï¼Œè€Œæ˜¯ç”± JS å¼€å‘è€…ä»¬è‡ªè¡Œç®¡ç†ï¼Œä»¥ä¾¿å°†æ¥èƒ½å¤Ÿç¼–å†™é«˜æ€§èƒ½ã€å¯å¹¶å‘çš„ç¨‹åºã€‚**

è¿™ä¸ªç‰¹æ€§ç”±ä¸€ä¸ªæ–°çš„å…¨å±€å¯¹è±¡ [SharedArrayBuffer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer) å®ç°ï¼Œå®ƒå°†æ•°æ®å­˜å‚¨åœ¨ä¸€å—**å…±äº«å†…å­˜ç©ºé—´**ä¸­ã€‚æ‰€ä»¥è¿™äº›æ•°æ®å¯ä»¥åœ¨ JS ä¸»çº¿ç¨‹å’Œ web-worker çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚

åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ JS ä¸»çº¿ç¨‹å’Œ web-worker ä¹‹é—´å…±äº«æ•°æ®ï¼Œæˆ‘ä»¬å¿…é¡»å¤åˆ¶æ•°æ®å¹¶ä½¿ç”¨ `postMessage` å°†å…¶å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚æ²¡åˆ«çš„åŠæ³•!

æ‚¨åªéœ€ä½¿ç”¨ SharedArrayBufferï¼Œæ•°æ®ç«‹é©¬å°±èƒ½åŒæ—¶è¢«ä¸»çº¿ç¨‹å’Œå¤šä¸ª web-worker çº¿ç¨‹è®¿é—®åˆ°ã€‚

ä½†åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«å†…å­˜å¯èƒ½ä¼šå¯¼è‡´ç«äº‰çŠ¶å†µã€‚ä¸ºäº†é¿å…ç«äº‰æ¡ä»¶ï¼Œåˆå¼•å…¥äº†å…¨å±€å¯¹è±¡ [Atomics](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics)ï¼ˆåŸå­æ€§ï¼‰ã€‚Atomics æä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œç”¨æ¥åœ¨ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å…±äº«å†…å­˜çš„æ•°æ®æ—¶ç»™å…±äº«å†…å­˜åŠ é”ã€‚å®ƒè¿˜æä¾›äº†æ–¹æ³•æ¥å®‰å…¨åœ°æ›´æ–°å…±äº«å†…å­˜ä¸­çš„ï¼ˆä¸Šé”çš„ï¼‰æ•°æ®ã€‚

> å»ºè®®é€šè¿‡æŸä¸ªåº“ä½¿ç”¨æ­¤ç‰¹æ€§ï¼Œä¸è¿‡ç›®å‰æ²¡æœ‰æ„å»ºåœ¨æ­¤åŠŸèƒ½ä¹‹ä¸Šçš„åº“ã€‚

å¦‚æœæ‚¨æœ‰å…´è¶£ï¼Œæ¨èé˜…è¯»ï¼š

1. [From Workers to Shared Memory](http://lucasfcosta.com/2017/04/30/JavaScript-From-Workers-to-Shared-Memory.html)â€Šâ€”â€Šlucasfcosta
2. [A cartoon intro to SharedArrayBuffers](https://hacks.mozilla.org/category/code-cartoons/a-cartoon-intro-to-sharedarraybuffers/)â€Šâ€”â€ŠLin Clark
3. [Shared memory and atomics](http://2ality.com/2017/01/shared-array-buffer.html)â€Šâ€”â€ŠDr. Axel Rauschmayer


- ### 2. ç§»é™¤äº†å¸¦æ ‡ç­¾çš„æ¨¡æ¿å­—ç¬¦ä¸²çš„é™åˆ¶

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ¸…æ¥šâ€œå¸¦æ ‡ç­¾çš„æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆTagged Template literalï¼‰â€æ˜¯ä»€ä¹ˆï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°ç†è§£è¿™ä¸ªç‰¹æ€§ã€‚

Tagged template literal æ˜¯ ES2015+ ä¸­çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸å¼€å‘è€…è‡ªå®šä¹‰å¦‚ä½•ä¿®æ”¹å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œä»¥æ ‡å‡†æ–¹å¼æ’å…¥å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹æ‰€ç¤º

```js
// æ ‡å‡†å­—ç¬¦ä¸²æ’å€¼
const firstName = 'Raja';
const greetings = `Hello ${firstName}!`;
console.log(greetings); // "Hello Raja!"
```

åœ¨ tagged template literal ä¸­ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼ˆä¾‹å¦‚`greet`ï¼‰ï¼Œå®ƒæ¥æ”¶å­—ç¬¦ä¸²æ–‡å­—çš„ç¡¬ç¼–ç éƒ¨åˆ†(æ¯”å¦‚ `['Hello'ï¼Œ'ï¼']`ï¼‰ä»¥åŠè¦æ›¿æ¢çš„å˜é‡ï¼ˆä¾‹å¦‚[`'Raja']`ï¼‰ä½œä¸ºå‚æ•°ï¼Œè¿”å›å€¼å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œç”±ä½ å†³å®šã€‚

ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†æˆ‘ä»¬çš„è‡ªå®šä¹‰â€œTagâ€å‡½æ•° `greet` æ ¹æ®å½“å‰æ—¶é—´ä¸ºæ¨¡æ¿å­—ç¬¦ä¸²æ·»åŠ ç›¸åº”çš„é—®å€™è¯­ã€‚

```js
// "æ ‡è®°â€å‡½æ•°è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰å­—ç¬¦ä¸²æ–‡å­—.
// åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œgreetè°ƒç”¨timeGreetï¼ˆï¼‰æ¥è¿½åŠ Good
// Morning/Afternoon/Evening è§†å½“å¤©çš„æ—¶é—´è€Œå®š.
function greet(hardCodedPartsArray, ...replacementPartsArray) {
 console.log(hardCodedPartsArray); //[ 'Hello ', '!' ]
 console.log(replacementPartsArray); //[ 'Raja' ]
let str = '';
 hardCodedPartsArray.forEach((string, i) => {
  if (i < replacementPartsArray.length) {
   str += `${string} ${replacementPartsArray[i] || ''}`;
  } else {
   str += `${string} ${timeGreet()}`; //<-- æ’å…¥ Good morning/afternoon/evening here
  }
 });
 return str;
}

// ç”¨æ³•
const firstName = 'Raja';
const greetings = greet`Hello ${firstName}!`; //ğŸ‘ˆğŸ¼<-- æ ‡è®°æ–‡å­—
console.log(greetings); //'Hello  Raja! Good Morning!' ğŸ”¥
function timeGreet() {
 const hr = new Date().getHours();
 return hr < 12
  ? 'Good Morning!'
  : hr < 18 ? 'Good Afternoon!' : 'Good Evening!';
}
```

ç°åœ¨æˆ‘ä»¬å·²ç»è®¨è®ºäº†â€œæ ‡ç­¾â€å‡½æ•°æ˜¯ä»€ä¹ˆï¼Œè®¸å¤šäººæƒ³è¦åœ¨ä¸åŒçš„åŸŸä¸­ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œæ¯”å¦‚ç”¨äºç»ˆç«¯å‘½ä»¤ï¼Œæˆ–è€…æ‹¼è£… HTTP è¯·æ±‚çš„ URI ç­‰ç­‰ã€‚

âš ï¸ æ ‡è®°å­—ç¬¦ä¸²æ–‡å­—çš„é—®é¢˜

é—®é¢˜æ˜¯ES2015å’ŒES2016è§„èŒƒä¸å…è®¸ä½¿ç”¨â€œ`\u`â€ï¼ˆunicodeï¼‰ï¼Œâ€œ`\x`â€ï¼ˆåå…­è¿›åˆ¶ï¼‰ç­‰è½¬ä¹‰å­—ç¬¦ï¼Œé™¤éå®ƒä»¬çœ‹èµ·æ¥å®Œå…¨åƒ`\u00A9`æˆ–`\uA9A`æˆ–`\xA9`ã€‚

å› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªå†…éƒ¨ä½¿ç”¨å…¶ä»–åŸŸè§„åˆ™ï¼ˆå¦‚ç»ˆç«¯è§„åˆ™ï¼‰çš„Taggedå‡½æ•°ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦ä½¿ç”¨**\ubla123abla**ï¼Œå®ƒçœ‹èµ·æ¥ä¸åƒ`\u0049`æˆ–`\u{@F804}`ï¼Œé‚£ä¹ˆæ‚¨å°†å¾—åˆ°è¯­æ³•é”™è¯¯ã€‚

åœ¨ES2018ä¸­ï¼Œåªè¦æ ‡è®°å‡½æ•°è¿”å›å…·æœ‰â€œcookedâ€å±æ€§ï¼ˆå…¶ä¸­æ— æ•ˆå­—ç¬¦ä¸ºâ€œundefinedâ€ï¼‰çš„å¯¹è±¡ä¸­çš„å€¼ï¼Œç„¶åå°†â€œrawâ€å±æ€§ï¼ˆä¸ä»»ä½•ä½ æƒ³è¦çš„ï¼‰ã€‚

```js

function myTagFunc(str) {
 return { "cooked": "undefined", "raw": str.raw[0] }
}

var str = myTagFunc `hi \ubla123abla`; //è°ƒç”¨ myTagFunc

str // { cooked: "undefined", raw: "hi \\unicode" }
```

- ### 3. æ­£åˆ™è¡¨è¾¾å¼çš„â€œ.â€æ ‡è¯†

ç›®å‰åœ¨æ­£åˆ™ä¸­ï¼Œè™½ç„¶ç‚¹å·ï¼ˆâ€œ.â€ï¼‰åº”è¯¥åŒ¹é…ä»»ä¸€å•ä¸ªå­—ç¬¦ï¼Œä½†å…¶å®å®ƒæ— æ³•åŒ¹é…æ¢è¡Œç¬¦ï¼Œå¦‚ `\n \r \f` ç­‰ç­‰ã€‚

æ¯”å¦‚ï¼š

```js
// ä¹‹å‰
/first.second/.test('first\nsecond'); //false
```

è¿™é¡¹æ”¹è¿›ä½¿ç‚¹å·å¯ä»¥åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚ä¸ºäº†ç¡®ä¿è¿™ä¸ä¼šç ´åä»»ä½•å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦ç»™æ­£åˆ™è¡¨è¾¾å¼åŠ ä¸Š `\s` æ ‡è¯†å®ƒæ‰ä¼šç”Ÿæ•ˆã€‚

```js
//ECMAScript 2018
/first.second/s.test('first\nsecond'); //true   Notice: /s ğŸ‘ˆğŸ¼
```

ä»¥ä¸‹æ˜¯[ææ¡ˆ](https://github.com/tc39/proposal-regexp-dotall-flag)æ–‡æ¡£ä¸­çš„ APIï¼š

```js
const re = /foo.bar/s;
// æˆ–è€… const re = new RegExp('foo.bar', 's');

re.test('f00\nbar'); //true
re.dotAll // true
re.flags // 's'

```

- ### 4. æ­£åˆ™è¡¨è¾¾å¼å‘½åç»„æ•è·(RegExp Named Group Captures ğŸ”¥)

è¿™ç§å¢å¼ºåŠŸèƒ½æ˜¯ä»å…¶ä»–è¯­è¨€ï¼ˆå¦‚Pythonï¼ŒJavaç­‰ï¼‰å¼•å…¥çš„æœ‰ç”¨ç‰¹æ€§ã€‚ç§°ä¸ºâ€œå‘½åç»„â€ã€‚è¯¥ç‰¹æ€§å…è®¸å¼€å‘è€…ä»¥ `(?<name> ...)` çš„å½¢å¼ä¸ºæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„åˆ†ç»„è¿›è¡Œå‘½åã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨è¯¥åç§°è½»æ¾è·å–ä»–ä»¬éœ€è¦çš„ä»»ä½•åˆ†ç»„ã€‚

- #### 4.1 åŸºæœ¬å‘½åç»„çš„ä¾‹å­

åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `(?<year>) (?<month>) å’Œ (?day)` åç§°å¯¹ä¸€ä¸ªæ—¥æœŸæ­£åˆ™çš„ä¸åŒéƒ¨åˆ†è¿›è¡Œåˆ†ç»„ã€‚ç»“æœå°†ä¼šæ˜¯ä¸€ä¸ªåŒ…å« `groups` çš„å¯¹è±¡ï¼Œå…¶å€¼åˆæ˜¯ä¸€ä¸ªåŒ…å« `year`ï¼Œ`month` å’Œ `day` å±æ€§çš„å¯¹è±¡ï¼Œå®ƒä»¬çš„å€¼åˆ†åˆ«æ˜¯å¯¹åº”çš„åˆ†ç»„æ•è·ã€‚

```js
// ä¹‹å‰
let re1 = /(\d{4})-(\d{2})-(\d{2})/;
let result1 = re1.exec('2015-01-02');
console.log(result1);
//
//["2015-01-02", "2015", "01", "02", index: 0, input: "2015-01-02", groups: undefined]

// ä»¥åï¼ˆES2018ï¼‰
let re2 = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/u;
let result2 = re2.exec('2015-01-02');
console.log(result2);
// ["2015-01-02", "2015", "01", "02", index: 0, input: "2015-01-02", groups: { year: '2015', month: '01', day: '02'}]


// ç”¨æ³•ï¼š
// ä½ æƒ³è¦çŸ¥é“å¹´ä»½ï¼Œä½ å¯ä»¥ï¼š

console.log(result2.groups.year) //2015


```

- #### 4.2 åœ¨æ­£åˆ™è¡¨è¾¾å¼æœ¬èº«å†…ä½¿ç”¨å‘½åç»„

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `\k<group name>` æ ¼å¼åœ¨æ­£åˆ™è¡¨è¾¾å¼æœ¬èº«ä¸­åå‘å¼•ç”¨è¯¥ç»„ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å®ƒçš„ç”¨æ³•ã€‚

```js
//ä¸‹é¢ä¾‹å­ï¼Œæœ‰ä¸ªç»„å«â€œfruitâ€
//å®ƒæ—¢èƒ½åŒ¹é…â€œappleâ€åˆèƒ½åŒ¹é…â€œorangeâ€.æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œ\k<group name>â€æ¥å›å¼•ç”¨è¿™ä¸ªç»„çš„ç»“æœ,(\k<fruit>)
//æ‰€ä»¥å®ƒåŒ¹é…==ä¸¤ä¾§çš„åŒä¸€ä¸ªå•è¯
let sameWords = /(?<fruit>apple|orange)==\k<fruit>/u;

sameWords.test('apple==apple');  //true
sameWords.test('orange==orange');  //true
sameWords.test('apple==orange');  //false

```

- #### 4.3 åœ¨ String.prototype.replace ä¸­ä½¿ç”¨å‘½åç»„

ç°åœ¨ï¼ŒString çš„ `replace` å®ä¾‹æ–¹æ³•ä¹ŸåŒ…å«äº†å‘½ååˆ†ç»„çš„ç‰¹æ€§ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°äº¤æ¢å­—ç¬¦ä¸²ä¸­çš„å•è¯ã€‚

ä¾‹å¦‚ï¼ŒæŠŠ â€œfirstName, lastNameâ€ å˜æˆ â€œlastName, firstNameâ€ã€‚

```js
// æ›´æ¢â€œfirstName, lastNameâ€ ==> â€œlastName, firstNameâ€

let re = /(?<firstName>[A-Za-z]+) (?<lastName>[A-Za-z]+$)/u;

'Raja Rao'.replace(re, '$<lastName>, $<firstName>'); // "Rao, Raja"

```

- ###  5. å¯¹è±¡çš„å…¶ä½™å±æ€§(Rest properties for Objects)

rest æ“ä½œç¬¦ `...`ï¼ˆä¸‰ä¸ªç‚¹ï¼‰å…è®¸æˆ‘ä»¬æå–å°šæœªæå–çš„å¯¹è±¡å±æ€§ã€‚

- #### 5.1 ä½ å¯ä»¥ä½¿ç”¨ rest æ¥å¸®åŠ©åªæå–ä½ æƒ³è¦çš„å±æ€§

```js
// æå– firstName å’Œ age
// å°†å…¶ä½™çš„é¡¹å­˜å‚¨åœ¨â€œremainingâ€å˜é‡ä¸­ã€‚

let { fristName, age, ...remaining } = {
	fristName: 'john',
	lastName: 'smith',
	age: 20,
	height: '5.10',
	race: 'martian',
};
firstName; //john
age //20
remaining //{ lastName: 'smith', height: '5.10', race: 'martian' }

```

- ####  5.2 æ›´å¥½çš„æ˜¯ï¼Œä½ å¯ä»¥åˆ é™¤ä¸éœ€è¦çš„ï¼ğŸ”¥ğŸ”¥

```js
//å‡è®¾æˆ‘ä»¬æƒ³è¦ç§»é™¤SSNï¼Œæˆ‘ä»¬ä¸éœ€è¦éå†æ•´ä¸ªå¯¹è±¡å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„cleanObjã€‚
// ç®€å•åœ°ä½¿ç”¨restè§£æ„æ¥æå–å‡ºSSNï¼Œå¹¶å°†å…¶ä½™çš„ä¿å­˜åœ¨cleanObjä¸­ã€‚

let { SSN, ...cleanObj } = {
	firstName: 'john',
	lastName: 'smith',
	SSN: '123-45-6789',
	race: 'martian',
}

cleanObj; //{	firstName: 'john', lastName: 'smith', race: 'martian' }

```

- ###  6. å±•å¼€å¯¹è±¡å±æ€§ (Spread properties for Objects)

å±•å¼€å±æ€§çœ‹èµ·æ¥å°±åƒå…·æœ‰ä¸‰ä¸ªç‚¹çš„ Rest å±æ€§ä¸€æ · `...`, ä½†åŒºåˆ«åœ¨äºæ‚¨ä½¿ç”¨å±•å¼€æ¥åˆ›å»ºï¼ˆé‡æ–°æ„å»ºï¼‰æ–°å¯¹è±¡ã€‚

> æç¤ºï¼šå±•å¼€æ“ä½œç¬¦ç”¨äºç­‰å·çš„å³ä¾§ã€‚Rest ç”¨äºç­‰å·çš„å·¦ä¾§ã€‚

```js
// person å’Œ account åˆå¹¶
const person = { fName: 'john', age: 20 };
const account = { name: 'bofa', amount: '$1000' };

// é€šè¿‡æ‰©å±•è¿ç®—ç¬¦æå–personå’Œaccountçš„å±æ€§ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ä¸€ä¸ªæ–°å¯¹è±¡ä¸­ã€‚
const personAndAccount = { ...person, ...account };
personAndAccount; // {fName: 'john', age: 20, name: 'bofa', amount: '$1000' }

```

- ###  7. æ­£åˆ™è¡¨è¾¾å¼çš„åè¡Œæ–­è¨€ï¼ˆé›¶å®½åå‘æ–­è¨€ï¼‰

è¿™æ˜¯å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å¢å¼ºï¼Œå®ƒå…è®¸æˆ‘ä»¬ç¡®ä¿æŸäº›å­—ç¬¦ä¸²å‡ºç°åœ¨å…¶ä»–å­—ç¬¦ä¸²*ä¹‹å‰*ã€‚

æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç»„ `(?<=...)`ï¼ˆé—®å·ï¼Œå°äºï¼Œç­‰äºï¼‰æ¥æŸ¥æ‰¾è‚¯å®šæ­£æ–­è¨€ã€‚

æ­¤å¤–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `(?<!...)`ï¼ˆé—®å·ï¼Œå°äºï¼Œæ„Ÿå¹å·ï¼‰æ¥æŸ¥çœ‹å¦è´Ÿæ–­è¨€ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œåªè¦æ–­è¨€é€šè¿‡ï¼Œå°±ä¼šåŒ¹é…ã€‚

æ­£æ–­è¨€ï¼šå‡è®¾æˆ‘ä»¬æƒ³è¦ç¡®ä¿ `ï¼ƒ` ç¬¦å·åœ¨å•è¯ `winning` ä¹‹å‰å­˜åœ¨ï¼ˆå³ï¼š`#winning`ï¼‰å¹¶ä¸”å¸Œæœ›æ­£åˆ™è¡¨è¾¾å¼åªè¿”å›å­—ç¬¦ä¸²â€œwinningâ€ã€‚ä½ å¯ä»¥è¿™æ ·å†™ã€‚

```js
/(?<=#).*/.test('winning'); // false
/(?<=#).*/.test('#winning'); // true

//ä¹‹å‰
'#winning'.match(/#.*/)[0]; // '#wining',åŒ…å«#

//ES2018å
'#winning'.match(/(?<=#).*/)[0]; // 'wining' æ²¡æœ‰#, #æ˜¯ç”¨æ¥éªŒè¯çš„ã€‚

```

è´Ÿæ–­è¨€ï¼šå‡è®¾æˆ‘ä»¬æƒ³æå–å‰é¢æ˜¯ â‚¬ ç¬¦å·è€Œä¸æ˜¯ $ ç¬¦å·çš„æ•°å­—ã€‚

```js
// 3.00ä¸èƒ½åŒ¹é…ï¼Œå› ä¸ºç¬¦å·$åœ¨å‰é¢

'A gallon of milk is $3.00'.match(/(?<\$)\d+\.?\d+/); // null

// 2.43åŒ¹é…æˆåŠŸï¼Œå› ä¸ºå‰é¢æ²¡æœ‰ç¬¦å·$
//å½“åŒ¹é…æ—¶ï¼Œä¸åŒ…å«ç¬¦å·â‚¬
'A gallon of milk is â‚¬3.00'.match(/(?<\$)\d+\.?\d+/)[0]; //2.43


```

- ### 8. æ­£åˆ™è¡¨è¾¾å¼ Unicode å±æ€§è½¬ä¹‰ï¼ˆ[RegExp Unicode Property Escapes](https://github.com/tc39/proposal-regexp-unicode-property-escapes)ï¼‰

è¦ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…å„ç§ Unicode å­—ç¬¦å¹¶ä¸å®¹æ˜“ã€‚åƒ `\w`ï¼Œ`\W`ï¼Œ`\d` ç­‰åªèƒ½åŒ¹é…è‹±æ–‡å­—ç¬¦å’Œæ•°å­—ã€‚ä½†æ˜¯å¯¹äºå°åº¦è¯­ï¼Œå¸Œè…Šè¯­ç­‰å…¶ä»–è¯­è¨€çš„æ•°å­—å‘¢ï¼Ÿ

è¿™å°±æ˜¯ Unicode Property Escapes çš„ç”¨æ­¦ä¹‹åœ°ã€‚ç»“æœæ˜¯ï¼ŒUnicode ä¸ºæ¯ä¸ªç¬¦å·ï¼ˆå­—ç¬¦ï¼‰æ·»åŠ äº†å…ƒæ•°æ®å±æ€§ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å¯¹å„ç§ç¬¦å·è¿›è¡Œåˆ†ç»„æˆ–æè¿°å„ç§ç¬¦å·ã€‚

ä¾‹å¦‚ï¼ŒUnicode æ•°æ®åº“å°†æ‰€æœ‰å°åœ°è¯­å­—ç¬¦ï¼ˆà¤¹à¤¿à¤¨à¥à¤¦à¥€ï¼‰æ”¾åœ¨ä¸€ä¸ªå€¼ä¸º `Devanagari` çš„ `Script` å±æ€§ï¼Œå’Œä¸€ä¸ªå…·æœ‰ç›¸åŒå€¼ `Devanagari ` çš„ `Script_Extensions`çš„å±æ€§ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœç´¢ `Script=Devanagari` å¾—åˆ°æ‰€æœ‰å°åœ°æ–‡å­—ç¬¦ã€‚

> Devanagari(æ¢µæ–‡)å¯ç”¨äºé©¬æ‹‰åœ°è¯­ï¼ŒåŒ—å°åº¦è¯­ï¼Œæ¢µè¯­ç­‰å„ç§å°åº¦è¯­è¨€ã€‚

ä» ECMAScript 2018 å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `\p` è½¬ä¹‰å­—ç¬¦å’Œ `{Script=Devanagari}` æ¥åŒ¹é…æ‰€æœ‰å°åº¦å­—ç¬¦ã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼š`\p{Script=Devanagari}` æ¥åŒ¹é…æ‰€æœ‰æ¢µæ–‡å­—ç¬¦ã€‚**

```js
//ä»–è·ŸéšåŒ¹é…å¤šä¸ªå°åœ°æ–‡å­—ç¬¦
/^\p{Script=Devanagari}+$/u.test('à¤¹à¤¿à¤¨à¥à¤¦à¥€'); //true
//PSï¼šæœ‰3ä¸ªå°åœ°æ–‡å­—ç¬¦h

```

ç±»ä¼¼åœ°ï¼ŒUnicode æ•°æ®åº“ä¸­å¸Œè…Šå­—ç¬¦çš„ `Script_Extensions`ï¼ˆå’Œ`Script`ï¼‰å€¼ä¸º`Greek`ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Script_Extensions=Greek` æˆ– `Script=Greek` æ¥æœç´¢æ‰€æœ‰å¸Œè…Šå­—ç¬¦ã€‚

**ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼š`\p{Script = Greek}` æ¥åŒ¹é…æ‰€æœ‰å¸Œè…Šå­—ç¬¦ã€‚**

```js
//ä»¥ä¸‹åŒ¹é…ä¸€ä¸ªå¸Œè…Šå­—ç¬¦
/\p{Script_Extensions=Greek}/u.test('Ï€'); // true

```


æ­¤å¤–ï¼ŒUnicode æ•°æ®åº“å°†å„ç§ç±»å‹çš„ Emoji å­˜å‚¨åœ¨å±æ€§å€¼ä¸ºâ€œtrueâ€çš„å¸ƒå°”å±æ€§ `Emoji`ï¼Œ`Emoji_Component`ï¼Œ`Emoji_Presentation`ï¼Œ`Emoji_Modifier` å’Œ `Emoji_Modifier_Base` ä¸‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°ä½¿ç”¨ `Emoji=true` æ¥æŸ¥æ‰¾æ‰€æœ‰è¡¨æƒ…ç¬¦å·ã€‚

**ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼š`\p{Emoji}`ï¼Œ`\Emoji_Modifier` ç­‰æ¥åŒ¹é…å„ç§ Emojiã€‚**


ä¸‹é¢çš„ä¾‹å­å°†ä¼šæ¸…æ¥šã€‚
```js
// ä¸‹é¢æ˜¯åŒ¹é…è¡¨æƒ…å­—ç¬¦
/\p{Emoji}/u.test('â¤ï¸'); //true
// ä¸‹é¢çš„æ“ä½œå¤±è´¥äº†ï¼Œå› ä¸ºé»„è‰²çš„emojisæ²¡æœ‰Emoji_Modifier!
/\p{Emoji}\p{Emoji_Modifier}/u.test('âœŒï¸'); //false
//ä¸‹é¢çš„æ“ä½œæ˜¯åŒ¹é…çš„ï¼Œ\p{Emoji} ç´§è·Ÿåé¢æ˜¯ \p{Emoji_Modifier}
/\p{Emoji}\p{Emoji_Modifier}/u.test('âœŒğŸ½'); //true
// è§£é‡Š:
// é»˜è®¤æƒ…å†µä¸‹ï¼Œèƒœåˆ©è¡¨æƒ…æ˜¯é»„è‰²çš„ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ç›¸åŒè¡¨æƒ…çš„æ£•è‰²ã€é»‘è‰²æˆ–å…¶ä»–ï¼Œå®ƒä»¬è¢«è®¤ä¸ºæ˜¯åŸå§‹è¡¨æƒ…çš„å˜ä½“ï¼Œå¹¶ä½¿ç”¨ä¸¤ä¸ªunicodeå­—ç¬¦è¡¨ç¤ºã€‚ä¸€ä¸ªæ˜¯åŸå§‹è¡¨æƒ…ç¬¦å·ï¼Œå¦ä¸€ä¸ªæ˜¯é¢œè‰²çš„unicodeå­—ç¬¦ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œè™½ç„¶æˆ‘ä»¬åªçœ‹åˆ°ä¸€ä¸ªæ£•è‰²çš„èƒœåˆ©è¡¨æƒ…ç¬¦å·ï¼Œä½†å®ƒå®é™…ä¸Šä½¿ç”¨äº†ä¸¤ä¸ªunicodeå­—ç¬¦ï¼Œä¸€ä¸ªç”¨äºè¡¨æƒ…ç¬¦å·ï¼Œå¦ä¸€ä¸ªç”¨äºæ£•è‰²ã€‚

//åœ¨Unicodeæ•°æ®åº“ä¸­ï¼Œè¿™äº›é¢œè‰²å…·æœ‰Emoji_Modifierå±æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨\p{Emoji}å’Œ\p{Emoji_Modifier}æ¥æ­£ç¡®å’Œå®Œå…¨åŒ¹é…æ£•è‰²çš„è¡¨æƒ…ç¬¦å·ã€‚

/\p{Emoji}\p{Emoji_Modifier}/u.test('âœŒğŸ½'); //true

```

**æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤§å†™çš„â€œPâ€ï¼ˆ`\P`ï¼‰è½¬ä¹‰å­—ç¬¦è€Œä¸æ˜¯å° pï¼ˆ`\p`ï¼‰æ¥å¦å®šåŒ¹é…ã€‚**

å‚è€ƒï¼š

1. [ECMAScript 2018 Proposal](https://mathiasbynens.be/notes/es-unicode-property-escapes)
2. [https://mathiasbynens.be/notes/es-unicode-property-escapes](https://mathiasbynens.be/notes/es-unicode-property-escapes)

- ###  9. Promise.prototype.finally()

`finally()` æ˜¯ Promise æ–°å¢çš„å®ä¾‹æ–¹æ³•ã€‚ä»–çš„ä¸»è¦æƒ³æ³•æ˜¯æ— è®º `resolve` æˆ–æ˜¯ `reject` åéƒ½æ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°ä»¥å¸®åŠ©æ¸…ç†äº‹æƒ…ã€‚**`finally` å›è°ƒè¢«è°ƒç”¨æ—¶ä¸ä¼ å…¥å‚æ•°ï¼Œå¹¶ä¸”æ— è®ºå¦‚ä½•æ€»æ˜¯è¢«æ‰§è¡Œã€‚**

æˆ‘ä»¬æ¥çœ‹çœ‹å„ç§æƒ…å†µ:

```js
// Resolve

let started = true;
let myPromise = new Promise(function(resolve, reject) {
	resolve('all good');
})
	.then(val => {
		console.log(val); //all good
	})
	.catch(e => {
		console.log(e)l // è·³è¿‡
	})
	.finally(() => {
		console.log('This function is always executed!');
		started = false; // æ¸…é™¤
	})


```

```js
// Reject
let started = true;
let myPromise = new Promise(function(resolve, reject) {
	resolve('reject apple');
})
	.then(val => {
		console.log(val); //reject apple
	})
	.catch(e => {
		console.log(e)l //catchè¢«è·³è¿‡
	})
	.finally(() => {
		//æ³¨æ„è¿™é‡Œæ²¡æœ‰ä»»ä½•å€¼
		console.log('This function is always executed!');
		started = false; //æ¸…é™¤
	})

```

```js
//é”™è¯¯æƒ…å†µ1
//Promise æŠ›å‡ºé”™è¯¯


let started = true;
let myPromise = new Promise(function(resolve, reject) {
	throw new Error('Error');
})
	.then(val => {
		console.log(val); // è·³è¿‡
	})
	.catch(e => {
		console.log(e)l // å‡ºç°é”™è¯¯catchè¢«è°ƒç”¨
	})
	.finally(() => {
		// æ³¨æ„è¿™é‡Œæ²¡æœ‰ä»»ä½•å€¼
		console.log('This function is always executed!');
		started = false; // æ¸…é™¤
	})


```

```js

// é”™è¯¯ä»â€œcatchâ€äº‹ä»¶ä¸­æŠ›å‡º

let started = true;
let myPromise = new Promise(function(resolve, reject) {
	throw new Error('something happend');
})
	.then(val => {
		console.log(val); // è·³è¿‡
	})
	.catch(e => {
		throw new Error('throw another error')
	})
	.finally(() => {
		// æ³¨æ„è¿™é‡Œæ²¡æœ‰ä»»ä½•å€¼
		console.log('This function is always executed!');
		started = false; //æ¸…é™¤
		// é”™è¯¯å½¢å¼çš„æ•è·å°†éœ€è¦åœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨å‡½æ•°æ¥å¤„ç†
	})


```
- ### 10. å¼‚æ­¥è¿­ä»£ (Asynchronous Iteration)

è¿™æ˜¯ä¸€ä¸ª\*éå¸¸\*æœ‰ç”¨çš„ç‰¹æ€§ã€‚åŸºæœ¬ä¸Šå®ƒå…è®¸æˆ‘ä»¬è½»æ¾åˆ›å»ºå¼‚æ­¥ä»£ç å¾ªç¯ï¼

è¿™ä¸ªç‰¹æ€§å¢åŠ äº†ä¸€ä¸ªæ–°çš„â€œfor-await-ofâ€å¾ªç¯ï¼Œå…è®¸æˆ‘ä»¬å¾ªç¯è°ƒç”¨è¿”å› Promiseï¼ˆæˆ– Promise æ•°ç»„ï¼‰çš„å¼‚æ­¥å‡½æ•°ã€‚å¾ˆé…·çš„ä¸€ç‚¹æ˜¯ï¼Œå¾ªç¯ä¼šç­‰å¾…æ¯ä¸ª Promise è¢« resolve æ‰è¿›å…¥ä¸‹ä¸€æ­¥ã€‚

```js
const promises = [
	new Promise(resolve => resolve(1)),
	new Promise(resolve => resolve(2)),
	new Promise(resolve => resolve(3)),
]
// ä¹‹å‰
// for-ofä½¿ç”¨å¸¸è§„åŒæ­¥è¿­ä»£å™¨
// ä¸ç­‰å¾…Promise å»è§£å†³

async function test1() {
	for (const obj of promise) {
		console.log(obj) // è®°å½•3 æ¡Promiseå¯¹è±¡
	}
}

// ä»¥å
// for-wait-ofä½¿ç”¨å¼‚æ­¥è¿­ä»£

async function test2() {
	for await (const obj of promises) {
		console.log(obj); // 1,2, 3
	}
}

test1() // promise, promise, promise
test2() // 1,2,3

```

åŸºæœ¬ä¸Šå°±æ˜¯è¿™äº›äº†ï¼