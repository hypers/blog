<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="React,优化,Webpack,"><link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.1.1"><meta name="description" content="React 相关的优化 使用 babel-react-optimize 对 React 代码进行优化 检查没有使用的库，去除 import 引用 按需打包所用的类库，比如 lodash 、echarts 等  lodash 可以采用 babel-plugin-lodash 进行优化。需要注意的是 在 babel-react-optimize 中使用了 babel-plugin-transform-"><meta name="keywords" content="React,优化,Webpack"><meta property="og:type" content="article"><meta property="og:title" content="React + Webpack 构建打包优化"><meta property="og:url" content="http://blog.rsuitejs.com/2018/01/22/react-webpack-optimize/index.html"><meta property="og:site_name" content="HYPERS 前端团队博客"><meta property="og:description" content="React 相关的优化 使用 babel-react-optimize 对 React 代码进行优化 检查没有使用的库，去除 import 引用 按需打包所用的类库，比如 lodash 、echarts 等  lodash 可以采用 babel-plugin-lodash 进行优化。需要注意的是 在 babel-react-optimize 中使用了 babel-plugin-transform-"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://blog.rsuitejs.com/2018/01/22/react-webpack-optimize/bundle.png"><meta property="og:updated_time" content="2019-02-14T04:30:39.256Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="React + Webpack 构建打包优化"><meta name="twitter:description" content="React 相关的优化 使用 babel-react-optimize 对 React 代码进行优化 检查没有使用的库，去除 import 引用 按需打包所用的类库，比如 lodash 、echarts 等  lodash 可以采用 babel-plugin-lodash 进行优化。需要注意的是 在 babel-react-optimize 中使用了 babel-plugin-transform-"><meta name="twitter:image" content="http://blog.rsuitejs.com/2018/01/22/react-webpack-optimize/bundle.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",sidebar:{position:"left",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.rsuitejs.com/2018/01/22/react-webpack-optimize/"><title>React + Webpack 构建打包优化 | HYPERS 前端团队博客</title><script>!function(e,t,n,c,a,r,s,h){e[n]=e[n]||[],e[n].push(r),e[r]=e[r]||function(){return(e[r].q=e[r].q||[]).push(arguments)},(s=t.createElement(c)).src="//t.hypers.com.cn/hwt.js?v=1.6",s.async=1,(h=t.getElementsByTagName(c)[0]).parentNode.insertBefore(s,h)}(window,document,"HyperAnalyticsObject","script",0,"_ha"),_ha("create","4080"),_ha("send","pageview")</script></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">HYPERS 前端团队博客</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/01/22/react-webpack-optimize/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">React + Webpack 构建打包优化</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-22T23:26:50+00:00">2018-01-22</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">1,887</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="React-相关的优化"><a href="#React-相关的优化" class="headerlink" title="React 相关的优化"></a>React 相关的优化</h2><ul><li>使用 <a href="https://github.com/thejameskyle/babel-react-optimize" target="_blank" rel="noopener">babel-react-optimize</a> 对 React 代码进行优化</li><li>检查没有使用的库，去除 import 引用</li><li>按需打包所用的类库，比如 <code>lodash</code> 、<code>echarts</code> 等</li></ul><p><code>lodash</code> 可以采用 <a href="https://github.com/lodash/babel-plugin-lodash" target="_blank" rel="noopener">babel-plugin-lodash</a> 进行优化。<br><strong>需要注意的是</strong></p><p>在 <code>babel-react-optimize</code> 中使用了 <code>babel-plugin-transform-react-remove-prop-types</code> 这个插件。正常情况下，如果你在代码中没有引用到组件的 <code>PropTypes</code>，则完全没问题。如果你的组件用到了，那么使用该插件可能会导致问题。<br>具体见：</p><blockquote><p><a href="https://github.com/oliviertassinari/babel-plugin-transform-react-remove-prop-types#is-it-safe" target="_blank" rel="noopener">https://github.com/oliviertassinari/babel-plugin-transform-react-remove-prop-types#is-it-safe</a></p></blockquote><h2 id="Webpack-构建打包优化"><a href="#Webpack-构建打包优化" class="headerlink" title="Webpack 构建打包优化"></a>Webpack 构建打包优化</h2><p>Webpack 构建打包存在的问题主要集中于下面两个方面：</p><ul><li>Webpack 构建速度慢</li><li>Webpack 打包后的文件体积过大</li></ul><h3 id="Webpack-构建速度慢"><a href="#Webpack-构建速度慢" class="headerlink" title="Webpack 构建速度慢"></a>Webpack 构建速度慢</h3><p>可以使用 <code>Webpack.DDLPlugin</code>，<code>HappyPack</code> 来提高构建速度。具体参见小铭在 DMP DDLPlugin 的文档。原文如下：</p><h4 id="Webpack-DLLPlugin"><a href="#Webpack-DLLPlugin" class="headerlink" title="Webpack.DLLPlugin"></a>Webpack.DLLPlugin</h4><ul><li>添加一个 webpack.dll.config.js</li></ul><p>主要是用到一个 DllPlugin 插件，把一些第三方的资源独立打包，同时放到一个 manifest.json 配置文件中，<br>这样在组件中更新后，就不会重新 build 这些第三方的资源，</p><ul><li>同时独立配置 dll/vendors.js 文件，提供给 webpack.dll.config.js</li><li>修改 package.json</li></ul><p>在 scripts 中添加: <code>&quot;dll&quot;: &quot;webpack --config webpack.dll.config.js --progress --colors &quot;,</code>。<br>执行 npm run dll 以后，会在 dll 目录下生产 两个文件 vendor-manifest.json ，vendor.dll.js</p><ul><li>配置 webpack.dev.config.js 文件，加入一个 DllReferencePlugin 插件，并指定 vendor-manifest.json 文件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">  context: join(__dirname, <span class="string">'src'</span>),</span><br><span class="line">  manifest: <span class="built_in">require</span>(<span class="string">'./dll/vendor-manifest.json'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>修改 html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">htmlWebpackPlugin.options.NODE_ENV</span> ===<span class="string">'development'</span>)&#123;   %&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dll/vendor.dll.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意，需要在 htmlWebpackPlugin 插件中配置 NODE_ENV 参数</p></blockquote><h4 id="Happypack"><a href="#Happypack" class="headerlink" title="Happypack"></a>Happypack</h4><p>通过多线程，缓存等方式提升 rebuild 效率 <a href="https://github.com/amireh/happypack" target="_blank" rel="noopener">https://github.com/amireh/happypack</a></p><ul><li>在 webpack.dev.config.js 中针对不同的资源创建多个 HappyPack, 比如 js 1 个，less 1 个，并设置好 id</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> HappyPack(&#123;</span><br><span class="line">  id: <span class="string">'js'</span>,</span><br><span class="line">  threadPool: happyThreadPool,</span><br><span class="line">  cache: <span class="literal">true</span>,</span><br><span class="line">  verbose: <span class="literal">true</span>,</span><br><span class="line">  loaders: [<span class="string">'babel-loader?babelrc&amp;cacheDirectory=true'</span>],</span><br><span class="line">&#125;),</span><br><span class="line"><span class="keyword">new</span> HappyPack(&#123;</span><br><span class="line">  id: <span class="string">'less'</span>,</span><br><span class="line">  threadPool: happyThreadPool,</span><br><span class="line">  cache: <span class="literal">true</span>,</span><br><span class="line">  verbose: <span class="literal">true</span>,</span><br><span class="line">  loaders: [<span class="string">'css-loader'</span>, <span class="string">'less-loader'</span>],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>在 module.rules 中配置 use 为 happypack/loader， 设置 id</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    <span class="string">'happypack/loader?id=js'</span></span><br><span class="line">  ],</span><br><span class="line">  exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">  loader: extractLess.extract(&#123;</span><br><span class="line">    use: [<span class="string">'happypack/loader?id=less'</span>],</span><br><span class="line">    fallback: <span class="string">'style-loader'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="减少-Webpack-打包后的文件体积大小"><a href="#减少-Webpack-打包后的文件体积大小" class="headerlink" title="减少 Webpack 打包后的文件体积大小"></a>减少 Webpack 打包后的文件体积大小</h3><p>首先需要对我们整个 bundle 进行分析，由哪些东西组成及各组成部分所占大小。<br>这里推荐 <a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank" rel="noopener">webpack-bundle-analyzer</a>。安装后在 <code>webpack.dev.config.js</code> 中添加插件即可，就能在每次启动后自动在网站打开分析结果，如下图</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugins.push( <span class="keyword">new</span> BundleAnalyzerPlugin());</span><br></pre></td></tr></table></figure> <img src="/2018/01/22/react-webpack-optimize/bundle.png" title="react bundle"><p>除此之外，还可以将打包过程输出成json文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack --profile --json -&gt; stats.json</span><br></pre></td></tr></table></figure><p>然后到下面这两个网站进行分析</p><ul><li><a href="http://webpack.github.io/analyse" target="_blank" rel="noopener">webpack/analyse</a></li><li><a href="http://alexkuz.github.io/webpack-chart/" target="_blank" rel="noopener">Webpack Chart</a></li></ul><p>通过上面的图表分析可以清楚得看到，整个 bundle.js 的组成部分及对应的大小。<br>解决 bundle.js 体积过大的解决思路如下：</p><ul><li>生产环境启用压缩等插件，去除不必要插件</li><li>拆分业务代码与第三方库及公共模块</li><li>webpack 开启 gzip 压缩</li><li>按需加载</li></ul><h4 id="生产环境启用压缩等插件，去除不必要插件"><a href="#生产环境启用压缩等插件，去除不必要插件" class="headerlink" title="生产环境启用压缩等插件，去除不必要插件"></a>生产环境启用压缩等插件，去除不必要插件</h4><p>确保在生产环境启动 <code>webpack.DefinePlugin</code> 和 <code>webpack.optimize.UglifyJsPlugin</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> plugins = [</span><br><span class="line">  <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">    <span class="string">'process.env.NODE_ENV'</span>: <span class="built_in">JSON</span>.stringify(process.env.NODE_ENV || <span class="string">'production'</span>)</span><br><span class="line">  &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">    compress: &#123;</span><br><span class="line">      warnings: <span class="literal">false</span>,</span><br><span class="line">      drop_console: <span class="literal">false</span> <span class="comment">//eslint-disable-line</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="拆分业务代码与第三方库及公共模块"><a href="#拆分业务代码与第三方库及公共模块" class="headerlink" title="拆分业务代码与第三方库及公共模块"></a>拆分业务代码与第三方库及公共模块</h4><p>由于项目的业务代码变更频率很高，而第三方库的代码变化则相对没有那么频率。如果将业务代码和第三库打包到同一个 chunk 的话，在每次构建的时候，哪怕业务代码只改了一行，即使第三方库的代码没有发生变化，会导致整个 chunk 的 hash 跟上一次不同。这不是我们想要的结果。我们想要的是，如果第三方库的代码没有变化，那在构建的时候也要保证对应的 hash 没有发生变化，从而能利用浏览器缓存，更好的提高页面加载性能和缩短页面加载时间。<br>因此可以将第三库的代码单独拆分成 vendor chunk，与业务代码分离。这样就算业务代码再怎么发生变化，只要第三方库代码没有发生变化，对应的 hash 就不变。<br>首先 <code>entry</code> 配置两个 <code>app</code> 和 <code>vendor</code> 两个chunk</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">  vendor: [path.join(__dirname, <span class="string">'dll'</span>, <span class="string">'vendors.js'</span>)],</span><br><span class="line">  app: [path.join(__dirname, <span class="string">'src/index'</span>)]</span><br><span class="line">&#125;,</span><br><span class="line">output: &#123;</span><br><span class="line">  path: path.resolve(__dirname, <span class="string">'build'</span>),</span><br><span class="line">  filename: <span class="string">'[name].[chunkhash:8].js'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>其中 <code>vendros.js</code> 是自己定义的哪些第三方库需要纳入 vendor 中，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'babel-polyfill'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'classnames'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'intl'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'isomorphic-fetch'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'react'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'react-dom'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'immutable'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'redux'</span>);</span><br></pre></td></tr></table></figure><p>然后通过 <code>CommonsChunkPlugin</code> 拆分第三库</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">plugins.push(</span><br><span class="line">  <span class="comment">// 拆分第三方库</span></span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123; <span class="attr">name</span>: <span class="string">'vendor'</span> &#125;),</span><br><span class="line">  <span class="comment">// 拆分 webpack 自身代码</span></span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">    name: <span class="string">'runtime'</span>,</span><br><span class="line">    minChunks: <span class="literal">Infinity</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>上面的配置有两个细节需要注意</p><ul><li>使用 <code>chunkhash</code> 而不用 <code>hash</code></li><li>单独拆分 webpack 自身代码</li></ul><p><strong>使用 <code>chunkhash</code> 而不用 <code>hash</code></strong></p><p>先来看看这二者有何区别：</p><ul><li>hash 是 <strong>build-specific</strong>，任何一个文件的改动都会导致编译的结果不同，适用于开发阶段</li><li>chunkhash 是 <strong>chunk-specific</strong>，是根据每个 chunk 的内容计算出的 hash，适用于生产</li></ul><p>因此为了保证第三方库不变的情况下，对应的 <code>vendor.js</code> 的 <code>hash</code> 也要保持不变，我们再 <code>output.filename</code> 中采用了 <code>chunkhash</code></p><p><strong>单独拆分 webpack 自身代码</strong></p><p>Webpack 有个已知问题：</p><blockquote><p>webpack 自身的 boilerplate 和 manifest 代码可能在每次编译时都会变化。</p></blockquote><p>这导致我们只是在 入口文件 改了一行代码，但编译出的 vendor 和 entry chunk 都变了，因为它们自身都包含这部分代码。</p><p>这是不合理的，因为实际上我们的第三方库的代码没变，vendor 不应该在我们业务代码变化时发生变化。<br>因此我们需要将 webpack 这部分代码分离抽离</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">"runtime"</span>,</span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>其中的 name 只要不在 entry 即可，通常使用 <code>&quot;runtime&quot;</code> 或 <code>&quot;manifest&quot;</code>。<br>另外一个参数 <code>minChunks</code> 表示：在传入公共chunk(commons chunk) 之前所需要包含的最少数量的 chunks。数量必须大于等于2，或者少于等于 chunks的数量，传入 <code>Infinity</code> 会马上生成 公共chunk，但里面没有模块。</p><p>更多关于 <code>CommonChunkPlugin</code> 可以查看 <a href="https://doc.webpack-china.org/plugins/commons-chunk-plugin/" target="_blank" rel="noopener">官方文档</a></p><h4 id="拆分公共资源"><a href="#拆分公共资源" class="headerlink" title="拆分公共资源"></a>拆分公共资源</h4><p>同 上面的拆分第三方库一样，拆分公共资源可以将公用的模块单独打出一个 chunk，你可以设置 <code>minChunk</code> 来选择是共用多少次模块才将它们抽离。配置如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">'common'</span>,</span><br><span class="line">  minChunks: <span class="number">2</span>,</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>是否需要进行这一步优化可以自行根据项目的业务复用度来判断。</p><h4 id="开启-gzip"><a href="#开启-gzip" class="headerlink" title="开启 gzip"></a>开启 gzip</h4><p>使用 <code>CompressionPlugin</code> 插件开启 <code>gzip</code> 即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加 gzip</span></span><br><span class="line"><span class="keyword">new</span> CompressionPlugin(&#123;</span><br><span class="line">  asset: <span class="string">'[path].gz[query]'</span>,</span><br><span class="line">  algorithm: <span class="string">'gzip'</span>,</span><br><span class="line">  test: <span class="regexp">/\.(js|html)$/</span>,</span><br><span class="line">  threshold: <span class="number">10240</span>,</span><br><span class="line">  minRatio: <span class="number">0.8</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h4><p>本篇不做具体介绍</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://github.com/creeperyang/blog/issues/37" target="_blank" rel="noopener">Webpack 日常使用与优化</a></li><li><a href="https://juejin.im/entry/5a41fbea6fb9a045117161a1" target="_blank" rel="noopener">使用 Webpack 打包单页应用的正确姿势</a></li><li><a href="https://zhuanlan.zhihu.com/p/25212283" target="_blank" rel="noopener">webpack打包分析与性能优化</a></li><li><a href="https://github.com/happylindz/blog/issues/7" target="_blank" rel="noopener">Webpack 持久化缓存实践</a></li><li><a href="https://github.com/happylindz/blog/issues/6" target="_blank" rel="noopener">深入理解 webpack 文件打包机制</a></li></ul><blockquote><p>本文作者：<a href="github.com/superman66">超人</a></p></blockquote></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/React/" rel="tag"><i class="fa fa-tag"></i> React</a><a href="/tags/优化/" rel="tag"><i class="fa fa-tag"></i> 优化</a><a href="/tags/Webpack/" rel="tag"><i class="fa fa-tag"></i> Webpack</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/09/09/form-lib/" rel="next" title="小而美的 React Form 组件"><i class="fa fa-chevron-left"></i> 小而美的 React Form 组件</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2018/03/28/build-a-app-width-electron-and-react/" rel="prev" title="如何使用 Electron 和 React 构建一个 APP">如何使用 Electron 和 React 构建一个 APP<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="gitment"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/hypers_logo.png" alt="Hypers"><p class="site-author-name" itemprop="name">Hypers</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">24</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">45</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#React-相关的优化"><span class="nav-number">1.</span> <span class="nav-text">React 相关的优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-构建打包优化"><span class="nav-number">2.</span> <span class="nav-text">Webpack 构建打包优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Webpack-构建速度慢"><span class="nav-number">2.1.</span> <span class="nav-text">Webpack 构建速度慢</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Webpack-DLLPlugin"><span class="nav-number">2.1.1.</span> <span class="nav-text">Webpack.DLLPlugin</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Happypack"><span class="nav-number">2.1.2.</span> <span class="nav-text">Happypack</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#减少-Webpack-打包后的文件体积大小"><span class="nav-number">2.2.</span> <span class="nav-text">减少 Webpack 打包后的文件体积大小</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#生产环境启用压缩等插件，去除不必要插件"><span class="nav-number">2.2.1.</span> <span class="nav-text">生产环境启用压缩等插件，去除不必要插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#拆分业务代码与第三方库及公共模块"><span class="nav-number">2.2.2.</span> <span class="nav-text">拆分业务代码与第三方库及公共模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#拆分公共资源"><span class="nav-number">2.2.3.</span> <span class="nav-text">拆分公共资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#开启-gzip"><span class="nav-number">2.2.4.</span> <span class="nav-text">开启 gzip</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按需加载"><span class="nav-number">2.2.5.</span> <span class="nav-text">按需加载</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">3.</span> <span class="nav-text">参考资料</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2019</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Hypers</span> <span class="post-count">- 全站共56.0k字</span></div><div class="powered-by"> 由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info"> 主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script></body></html>